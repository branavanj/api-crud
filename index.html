<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Front End de l'API</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Testez l'API</h1>

  <!-- Formulaire de connexion -->
  <section>
    <h2>Authentification</h2>
    <form id="loginForm">
      <label>Email: <input type="email" id="email" required></label><br>
      <label>Mot de passe: <input type="password" id="password" required></label><br>
      <button type="submit">Se connecter</button>
    </form>
    <p id="loginResult"></p>
  </section>

  <!-- Formulaire de création de commande -->
  <section>
    <h2>Créer une commande</h2>
    <form id="orderForm">
      <label>Item: <input type="text" id="item" required></label><br>
      <label>Quantité: <input type="number" id="quantity" required></label><br>
      <button type="submit">Créer la commande</button>
    </form>
    <p id="orderResult"></p>
  </section>

  <!-- Bouton pour récupérer les commandes -->
  <section>
    <h2>Liste des commandes</h2>
    <button id="fetchOrders">Charger les commandes</button>
    <ul id="ordersList"></ul>
  </section>

  <script>
    let authToken = '';

    // Authentification
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const response = await fetch('/authenticate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });
      const data = await response.json();
      if (data.token) {
        authToken = data.token;
        document.getElementById('loginResult').innerText = 'Connexion réussie !';
      } else {
        document.getElementById('loginResult').innerText = data.error;
      }
    });

    // Créer une commande
    document.getElementById('orderForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const item = document.getElementById('item').value;
      const quantity = parseInt(document.getElementById('quantity').value);
      const response = await fetch('/orders', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + authToken
        },
        body: JSON.stringify({ item, quantity })
      });
      const data = await response.json();
      document.getElementById('orderResult').innerText = data.message || data.error;
    });

    // Récupérer la liste des commandes
    document.getElementById('fetchOrders').addEventListener('click', async () => {
      const response = await fetch('/orders', {
        headers: { 'Authorization': 'Bearer ' + authToken }
      });
      const orders = await response.json();
      const ordersList = document.getElementById('ordersList');
      ordersList.innerHTML = '';
      orders.forEach(order => {
        const li = document.createElement('li');
        li.textContent = `ID: ${order.id} - Item: ${order.item} - Quantité: ${order.quantity}`;
        ordersList.appendChild(li);
      });
    });
  </script>
</body>
</html>
